<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spotify Pulse — Tus Canciones</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<script src="//unpkg.com/three"></script>
<script src="//unpkg.com/three-globe"></script>
<style>
  :root {
    --bg: #060810;
    --surface: #0d1117;
    --surface2: #131921;
    --border: rgba(255,255,255,0.07);
    --green: #1DB954;
    --green-dim: rgba(29,185,84,0.15);
    --green-glow: rgba(29,185,84,0.4);
    --text: #e8eaf0;
    --muted: #6b7280;
    --accent: #c084fc;
    --accent2: #38bdf8;
    --red: #f87171;
    --yellow: #fbbf24;
  }
  
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--bg); color:var(--text); font-family:'Syne',sans-serif; min-height:100vh; overflow-x:hidden; }

  /* GLOBO ARREGLADO */
  #globe-container { width: 100%; height: 500px; cursor: grab; position: relative; }
  #globe-container:active { cursor: grabbing; }

  /* WRAPPED REDISEÑADO */
  .wrapped-hero-new {
    position: relative;
    width: 100%;
    height: 480px;
    border-radius: 32px;
    overflow: hidden;
    margin-bottom: 3rem;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    padding: 4rem;
    border: 1px solid var(--border);
  }
  .wrapped-hero-bg {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
    filter: saturate(1.2) brightness(0.5);
    z-index: 0;
    transition: transform 0.5s ease;
  }
  .wrapped-hero-new:hover .wrapped-hero-bg { transform: scale(1.05); }
  .wrapped-hero-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to top, var(--bg) 5%, transparent 70%);
    z-index: 1;
  }
  .wrapped-hero-content { position: relative; z-index: 2; }
  .hero-hours { font-family: 'JetBrains Mono'; color: var(--green); font-weight: 700; letter-spacing: 0.2em; font-size: 0.85rem; margin-bottom: 0.5rem; display: block; }
  .hero-title { font-size: 5rem; font-weight: 800; letter-spacing: -0.05em; line-height: 0.9; margin-bottom: 1rem; }

  /* STATS CARDS */
  .wrapped-stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 3rem; }
  .stat-card-new {
    background: var(--surface);
    padding: 2rem;
    border-radius: 20px;
    position: relative;
    border: 1px solid var(--border);
    transition: transform 0.3s ease;
  }
  .stat-card-new:hover { transform: translateY(-5px) scale(1.02); }
  .stat-card-new::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; border-radius: 20px 20px 0 0; }
  .stat-card-new.green::before { background: var(--green); }
  .stat-card-new.purple::before { background: var(--accent); }
  .stat-card-new.blue::before { background: var(--accent2); }
  .stat-card-new.yellow::before { background: var(--yellow); }

  /* COLUMNAS WRAPPED */
  .wrapped-columns { display: grid; grid-template-columns: 1.2fr 1fr; gap: 3rem; }
  .artist-grid-mini { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1.5rem; }
  .artist-mini-card {
    aspect-ratio: 1;
    border-radius: 16px;
    overflow: hidden;
    position: relative;
    cursor: pointer;
    border: 1px solid var(--border);
  }
  .artist-mini-card img { width: 100%; height: 100%; object-fit: cover; transition: 0.3s; }
  .artist-mini-card:hover img { transform: scale(1.1); }
  .artist-mini-name {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    padding: 0.8rem;
    background: linear-gradient(transparent, rgba(0,0,0,0.9));
    font-size: 0.8rem;
    font-weight: 700;
  }

  /* DÉCADAS */
  .decades-full-width {
    grid-column: 1 / -1;
    background: var(--surface);
    padding: 3rem;
    border-radius: 24px;
    margin-top: 2rem;
    border: 1px solid var(--border);
  }
  .decade-row-flex { display: flex; align-items: flex-end; gap: 1.5rem; height: 150px; margin-top: 2rem; }
  .decade-bar-new {
    flex: 1;
    border-radius: 8px 8px 0 0;
    position: relative;
    transition: height 1s ease;
    min-height: 10px;
  }
  .decade-label-new {
    position: absolute;
    bottom: -25px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.75rem;
    color: var(--muted);
    font-family: 'JetBrains Mono';
  }

  /* BARRA ANIMADA CANCIONES */
  .animated-bar-container { margin-bottom: 1.2rem; }
  .bar-info { display: flex; justify-content: space-between; margin-bottom: 0.4rem; font-size: 0.85rem; }
  .bar-bg { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
  .bar-fill { height: 100%; background: var(--green); width: 0; transition: width 1.5s cubic-bezier(0.1, 0, 0.2, 1); }

  .section-title-alt { font-size: 1.2rem; font-weight: 800; margin-bottom: 0.5rem; letter-spacing: -0.02em; }
</style>
</head>
<body>

<div id="dashboard">
  <div id="wrapped-content"></div>
  <div id="globe-section">
    <h3 class="section-title-alt" style="text-align:center; margin-top:4rem;">Tu Alcance Global</h3>
    <div id="globe-container"></div>
  </div>
</div>

<script>
// DATOS DE EJEMPLO (Se reemplazarían por tu lógica de Spotify)
const mockData = {
  totalHours: 1240,
  totalTracks: 4820,
  totalArtists: 912,
  topTracks: [
    { name: "Starboy", artist: "The Weeknd", cover: "https://i.scdn.co/image/ab67616d0000b2734718e2b040066d0ef92824b0", pct: 100 },
    { name: "Blinding Lights", artist: "The Weeknd", cover: "https://i.scdn.co/image/ab67616d0000b2738863bc11fafbf38292c3003a", pct: 85 }
  ],
  topArtists: [
    { name: "The Weeknd", img: "https://i.scdn.co/image/ab6761610000e5eb214f3bc649479e000787e221" },
    { name: "Arctic Monkeys", img: "https://i.scdn.co/image/ab6761610000e5eb7da39dea0a72f581535fb11f" },
    { name: "Daft Punk", img: "https://i.scdn.co/image/ab6761610000e5eb2d47e7428f73117462377b61" },
    { name: "Lana Del Rey", img: "https://i.scdn.co/image/ab6761610000e5eb214f3bc649479e000787e221" },
    { name: "Kanye West", img: "https://i.scdn.co/image/ab6761610000e5eb214f3bc649479e000787e221" },
    { name: "Dua Lipa", img: "https://i.scdn.co/image/ab6761610000e5eb214f3bc649479e000787e221" }
  ],
  decades: [
    { year: "80", pct: 40, color: "#f87171" },
    { year: "90", pct: 60, color: "#fbbf24" },
    { year: "00", pct: 90, color: "#38bdf8" },
    { year: "10", pct: 75, color: "#c084fc" },
    { year: "20", pct: 100, color: "#1DB954" }
  ],
  countries: [
    { lat: 40.4168, lng: -3.7038, count: 50 }, // España
    { lat: 19.4326, lng: -99.1332, count: 120 }, // México
    { lat: 37.0902, lng: -95.7129, count: 200 } // USA
  ]
};

function renderWrapped() {
  const container = document.getElementById('wrapped-content');
  const topSong = mockData.topTracks[0];

  container.innerHTML = `
    <div class="wrapped-hero-new">
      <div class="wrapped-hero-bg" style="background-image: url('${topSong.cover}')"></div>
      <div class="wrapped-hero-overlay"></div>
      <div class="wrapped-hero-content">
        <span class="hero-hours">${mockData.totalHours} HORAS TOTALES DE ESCUCHA</span>
        <h1 class="hero-title">${topSong.name}</h1>
        <p style="color:var(--muted); font-family:'JetBrains Mono';">Canción número 1 en tu 2024</p>
      </div>
    </div>

    <div class="wrapped-stats-grid">
      <div class="stat-card-new green">
        <div class="hero-hours" style="color:var(--muted)">CANCIONES</div>
        <div class="hero-title" style="font-size:2.5rem; margin:0">${mockData.totalTracks}</div>
      </div>
      <div class="stat-card-new purple">
        <div class="hero-hours" style="color:var(--muted)">ARTISTAS</div>
        <div class="hero-title" style="font-size:2.5rem; margin:0">${mockData.totalArtists}</div>
      </div>
      <div class="stat-card-new blue">
        <div class="hero-hours" style="color:var(--muted)">GÉNEROS</div>
        <div class="hero-title" style="font-size:2.5rem; margin:0">42</div>
      </div>
      <div class="stat-card-new yellow">
        <div class="hero-hours" style="color:var(--muted)">PAÍSES</div>
        <div class="hero-title" style="font-size:2.5rem; margin:0">${mockData.countries.length}</div>
      </div>
    </div>

    <div class="wrapped-columns">
      <div>
        <h3 class="section-title-alt">Top Artistas</h3>
        <div class="artist-grid-mini">
          ${mockData.topArtists.map(a => `
            <div class="artist-mini-card">
              <img src="${a.img}">
              <div class="artist-mini-name">${a.name}</div>
            </div>
          `).join('')}
        </div>
      </div>

      <div>
        <h3 class="section-title-alt">Top Canciones</h3>
        <div style="margin-top:1.5rem;">
          ${mockData.topTracks.map(t => `
            <div class="animated-bar-container">
              <div class="bar-info">
                <span>${t.name}</span>
                <span style="color:var(--muted)">${t.artist}</span>
              </div>
              <div class="bar-bg"><div class="bar-fill" style="width:${t.pct}%"></div></div>
            </div>
          `).join('')}
        </div>
      </div>

      <div class="decades-full-width">
        <h3 class="section-title-alt">Décadas favoritas</h3>
        <div class="decade-row-flex">
          ${mockData.decades.map(d => `
            <div class="decade-bar-new" style="height:${d.pct}%; background:${d.color}">
              <span class="decade-label-new">${d.year}s</span>
            </div>
          `).join('')}
        </div>
      </div>
    </div>
  `;
}

function initGlobe() {
  const container = document.getElementById('globe-container');
  const maxCount = Math.max(...mockData.countries.map(c => c.count));

  const globe = new ThreeGlobe()
    .globeImageUrl('//unpkg.com/three-globe/example/img/earth-dark.jpg')
    .pointsData(mockData.countries.map(c => ({
      lat: c.lat,
      lng: c.lng,
      size: (c.count / maxCount) * 1.2, // El tamaño escala con las canciones
      color: '#1DB954'
    })))
    .pointAltitude(0.01)
    .pointRadius('size')
    .pointColor('color')
    .ringsData(mockData.countries)
    .ringColor(() => '#1DB954')
    .ringMaxRadius(2.5)
    .ringPropagationSpeed(1)
    .ringRepeatPeriod(1500);

  const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  renderer.setSize(container.offsetWidth, 500);
  container.appendChild(renderer.domElement);

  const scene = new THREE.Scene();
  scene.add(globe);
  scene.add(new THREE.AmbientLight(0xbbbbbb, 0.5));
  
  const camera = new THREE.PerspectiveCamera(75, container.offsetWidth / 500, 0.1, 1000);
  camera.position.z = 250;

  // Solo rota cuando arrastras
  const controls = new (THREE.OrbitControls || Object)(camera, renderer.domElement);
  if(THREE.OrbitControls) {
    controls.enableDamping = true;
    controls.autoRotate = false; 
  }

  (function animate() {
    if(controls.update) controls.update();
    renderer.render(scene, camera);
    requestAnimationFrame(animate);
  })();
}

// Ejecutar
renderWrapped();
// Nota: Requiere OrbitControls.js para el giro manual, 
// pero la lógica del globo está lista según lo pedido.
setTimeout(initGlobe, 500); 
</script>
<script src="https://unpkg.com/three@0.126.1/examples/js/controls/OrbitControls.js"></script>

</body>
</html>
